name: Frontend Deploy

on:
  push:
    branches:
      - main  # Trigger this workflow on push to the 'main' branch

jobs:
  deploy:
    runs-on: ubuntu-latest  # Using the latest Ubuntu runner for the CI/CD job

    steps:
      - name: Checkout code
        uses: actions/checkout@v3  # Checkout the code from the repository

      - name: Set up SSH
        run: |
          # Create the .ssh directory if it doesn't exist
          mkdir -p ~/.ssh

          # Add the private key from GitHub secrets to a file
          echo "${{ secrets.DEPLOY_KEY }}" > ~/.ssh/id_rsa

          # Set the correct permissions for the private key
          chmod 600 ~/.ssh/id_rsa

          # Add the EC2 host to known hosts to avoid SSH verification issues
          ssh-keyscan -H 13.211.219.32 >> ~/.ssh/known_hosts  # Replace with your EC2 public IP

      - name: Test SSH connection
        run: |
          # Test the SSH connection to ensure it works
          ssh -i ~/.ssh/id_rsa -o StrictHostKeyChecking=no ubuntu@13.211.219.32 echo "âœ… Connected!"  # Replace with your EC2 IP

      - name: Deploy to EC2
        run: |
          # SSH into the EC2 instance and deploy your app
          ssh -i ~/.ssh/id_rsa -o StrictHostKeyChecking=no ubuntu@13.211.219.32 '
            cd ~/app/web-dashboard/vue-web-dashboard &&  # Ensure correct path here
            git pull &&  # Pull the latest code from the repository
            npm install &&  # Install any dependencies
            npm run build  # Build the project
          '
